mutate("PULSE05 to Fuller1" = (Ful1-PULSE05)/PULSE05,
"PULSE05 to Fuller4" = (Ful4-PULSE05)/PULSE05,
"PULSE05 to TSLS" = (TSLS-PULSE05)/PULSE05,
"PULSE05 to OLS" =(OLS-PULSE05)/PULSE05
)  %>%
select(-Ful1,-Ful4,-OLS,-PULSE05,-TSLS,-LIML)  %>%
gather(Type,Value,c(-Fstat,-rho,-nInst,-Conc,-Rsq,-n,-MeanGn )) %>%
mutate(rho=factor(rho), n = factor(n)) %>%
filter(!(Type=="PULSE05 to TSLS" & nInst <2 ))
ggplot(data = MeanBias_plotdata)+
geom_point(aes(x=log(MeanGn),y=Value,color=rho,shape=n)) +
geom_vline(xintercept =log(10),color="black",linetype="dotted") +
geom_vline(xintercept =log(1.55),color="black",linetype="dashed") +
facet_wrap(~Type,scales= "free")+
xlab(expression(log(hat(E)[N](G[n]))))+
labs(colour=expression(rho))+
ylab(expression(paste("Relative Change in Mean Bias")))+
theme(plot.margin = unit(c(0,0.8,0,0), "cm"))
MeanBias_plotdata <- dat2 %>%
select(-MedianBias,-IQRestimate,-RMSE,-VarEstimate) %>%
mutate(Bias = abs(MeanEstimate)) %>%
spread(Type,Bias) %>%
arrange(rho,nInst,Rsq,n,nInst) %>%
mutate("PULSE05 to Fuller1" = (Ful1-PULSE05)/PULSE05,
"PULSE05 to Fuller4" = (Ful4-PULSE05)/PULSE05,
"PULSE05 to TSLS" = (TSLS-PULSE05)/PULSE05,
"PULSE05 to OLS" =(OLS-PULSE05)/PULSE05
)  %>%
select(-Ful1,-Ful4,-OLS,-PULSE05,-TSLS,-LIML)  %>%
gather(Type,Value,c(-Fstat,-rho,-nInst,-Conc,-Rsq,-n,-MeanGn )) %>%
mutate(rho=factor(rho), n = factor(n)) %>%
filter(!(Type=="PULSE05 to TSLS" & nInst <2 ))
ggplot(data = MeanBias_plotdata)+
geom_point(aes(x=log(MeanGn),y=Value,color=rho,shape=n)) +
geom_vline(xintercept =log(10),color="black",linetype="dotted") +
geom_vline(xintercept =log(1.55),color="black",linetype="dashed") +
facet_wrap(~Type,scales= "free")+
xlab(expression(log(hat(E)[N](G[n]))))+
labs(colour=expression(rho))+
ylab(expression(paste("Relative Change in Mean Bias")))+
theme(plot.margin = unit(c(0,0.8,0,0), "cm"))
dat2 %>%
select(-MedianBias,-IQRestimate,-RMSE,-VarEstimate) %>%
mutate(Bias = abs(MeanEstimate)) %>%
spread(Type,Bias)
dat2 %>%
select(-MedianBias,-IQRestimate,-RMSE,-VarEstimate) %>%
mutate(Bias = abs(MeanEstimate))
MeanBias_plotdata <- dat2 %>%
mutate(Bias = abs(MeanEstimate)) %>%
select(-MedianBias,-IQRestimate,-RMSE,-VarEstimate,-MeanEstimate) %>%
spread(Type,Bias) %>%
arrange(rho,nInst,Rsq,n,nInst) %>%
mutate("PULSE05 to Fuller1" = (Ful1-PULSE05)/PULSE05,
"PULSE05 to Fuller4" = (Ful4-PULSE05)/PULSE05,
"PULSE05 to TSLS" = (TSLS-PULSE05)/PULSE05,
"PULSE05 to OLS" =(OLS-PULSE05)/PULSE05
)  %>%
select(-Ful1,-Ful4,-OLS,-PULSE05,-TSLS,-LIML)  %>%
gather(Type,Value,c(-Fstat,-rho,-nInst,-Conc,-Rsq,-n,-MeanGn )) %>%
mutate(rho=factor(rho), n = factor(n)) %>%
filter(!(Type=="PULSE05 to TSLS" & nInst <2 ))
ggplot(data = MeanBias_plotdata)+
geom_point(aes(x=log(MeanGn),y=Value,color=rho,shape=n)) +
geom_vline(xintercept =log(10),color="black",linetype="dotted") +
geom_vline(xintercept =log(1.55),color="black",linetype="dashed") +
facet_wrap(~Type,scales= "free")+
xlab(expression(log(hat(E)[N](G[n]))))+
labs(colour=expression(rho))+
ylab(expression(paste("Relative Change in Mean Bias")))+
theme(plot.margin = unit(c(0,0.8,0,0), "cm"))
ggsave(paste0("Plots/Univariate_MeanBias",ID,".png"), plot = last_plot(), device = NULL, path = NULL,
scale = 1, width = 12, height = 6, units = c("in"),
dpi = 200, limitsize = FALSE)
Variance_plotdata <- dat2 %>%
select(-MedianBias,-IQRestimate,-RMSE,-MeanEstimate) %>%
spread(Type,VarEstimate) %>%
arrange(rho,nInst,Rsq,n,nInst) %>%
mutate("PULSE05 to Fuller1" = (Ful1-PULSE05)/PULSE05,#ifelse((Ful1-PULSE05)/PULSE05 >= 0, (Ful1-PULSE05)/PULSE05, -(PULSE05-Ful1)/Ful1),
"PULSE05 to Fuller4" = (Ful4-PULSE05)/PULSE05,#ifelse((Ful4-PULSE05)/PULSE05 >= 0, (Ful4-PULSE05)/PULSE05, -(PULSE05-Ful4)/Ful4),
"PULSE05 to TSLS" = (TSLS-PULSE05)/PULSE05,#ifelse((TSLS-PULSE05)/PULSE05 >= 0, (TSLS-PULSE05)/PULSE05, -(PULSE05-TSLS)/TSLS),
"PULSE05 to OLS" =(OLS-PULSE05)/PULSE05 #ifelse((OLS-PULSE05)/PULSE05 >= 0, (OLS-PULSE05)/PULSE05, -(PULSE05-OLS)/OLS),
)  %>%
select(-Ful1,-Ful4,-OLS,-PULSE05,-PULSE10,-PULSE50,-TSLS,-LIML)  %>%
gather(Type,Value,c(-Fstat,-rho,-nInst,-Conc,-Rsq,-n,-MeanGn )) %>%
mutate(rho=factor(rho), n = factor(n)) %>%
filter(!(Type=="PULSE05 to TSLS" & nInst <3 ),rho!=-0.5)
ggplot(data = Variance_plotdata)+
geom_point(aes(x=log(MeanGn),y=Value,color=rho,shape=n)) +
geom_vline(xintercept =log(10),color="black",linetype="dotted") +
geom_vline(xintercept =log(1.55),color="black",linetype="dashed") +
facet_wrap(~Type,scales= "free")+
xlab(expression(log(hat(E)[N](G[n]))))+
labs(colour=expression(rho))+
ylab(expression(paste("Relative Change in Variance")))+
theme(plot.margin = unit(c(0,0.8,0,0), "cm"))
Variance_plotdata <- dat2 %>%
select(-MedianBias,-IQRestimate,-RMSE,-MeanEstimate) %>%
spread(Type,VarEstimate) %>%
arrange(rho,nInst,Rsq,n,nInst) %>%
mutate("PULSE05 to Fuller1" = (Ful1-PULSE05)/PULSE05,#ifelse((Ful1-PULSE05)/PULSE05 >= 0, (Ful1-PULSE05)/PULSE05, -(PULSE05-Ful1)/Ful1),
"PULSE05 to Fuller4" = (Ful4-PULSE05)/PULSE05,#ifelse((Ful4-PULSE05)/PULSE05 >= 0, (Ful4-PULSE05)/PULSE05, -(PULSE05-Ful4)/Ful4),
"PULSE05 to TSLS" = (TSLS-PULSE05)/PULSE05,#ifelse((TSLS-PULSE05)/PULSE05 >= 0, (TSLS-PULSE05)/PULSE05, -(PULSE05-TSLS)/TSLS),
"PULSE05 to OLS" =(OLS-PULSE05)/PULSE05 #ifelse((OLS-PULSE05)/PULSE05 >= 0, (OLS-PULSE05)/PULSE05, -(PULSE05-OLS)/OLS),
)  %>%
select(-Ful1,-Ful4,-OLS,-PULSE05,-PULSE10,-PULSE50,-TSLS,-LIML)  %>%
gather(Type,Value,c(-Fstat,-rho,-nInst,-Conc,-Rsq,-n,-MeanGn )) %>%
mutate(rho=factor(rho), n = factor(n)) %>%
filter(!(Type=="PULSE05 to TSLS" & nInst <3 ),rho!=-0.5)
Variance_plotdata <- dat2 %>%
select(-MedianBias,-IQRestimate,-RMSE,-MeanEstimate) %>%
spread(Type,VarEstimate) %>%
arrange(rho,nInst,Rsq,n,nInst) %>%
mutate("PULSE05 to Fuller1" = (Ful1-PULSE05)/PULSE05,#ifelse((Ful1-PULSE05)/PULSE05 >= 0, (Ful1-PULSE05)/PULSE05, -(PULSE05-Ful1)/Ful1),
"PULSE05 to Fuller4" = (Ful4-PULSE05)/PULSE05,#ifelse((Ful4-PULSE05)/PULSE05 >= 0, (Ful4-PULSE05)/PULSE05, -(PULSE05-Ful4)/Ful4),
"PULSE05 to TSLS" = (TSLS-PULSE05)/PULSE05,#ifelse((TSLS-PULSE05)/PULSE05 >= 0, (TSLS-PULSE05)/PULSE05, -(PULSE05-TSLS)/TSLS),
"PULSE05 to OLS" =(OLS-PULSE05)/PULSE05 #ifelse((OLS-PULSE05)/PULSE05 >= 0, (OLS-PULSE05)/PULSE05, -(PULSE05-OLS)/OLS),
)  %>%
select(-Ful1,-Ful4,-OLS,-PULSE05,-TSLS,-LIML)  %>%
gather(Type,Value,c(-Fstat,-rho,-nInst,-Conc,-Rsq,-n,-MeanGn )) %>%
mutate(rho=factor(rho), n = factor(n)) %>%
filter(!(Type=="PULSE05 to TSLS" & nInst <3 ),rho!=-0.5)
ggplot(data = Variance_plotdata)+
geom_point(aes(x=log(MeanGn),y=Value,color=rho,shape=n)) +
geom_vline(xintercept =log(10),color="black",linetype="dotted") +
geom_vline(xintercept =log(1.55),color="black",linetype="dashed") +
facet_wrap(~Type,scales= "free")+
xlab(expression(log(hat(E)[N](G[n]))))+
labs(colour=expression(rho))+
ylab(expression(paste("Relative Change in Variance")))+
theme(plot.margin = unit(c(0,0.8,0,0), "cm"))
Variance_plotdata <- dat2 %>%
select(-MedianBias,-IQRestimate,-RMSE,-MeanEstimate) %>%
spread(Type,VarEstimate) %>%
arrange(rho,nInst,Rsq,n,nInst) %>%
mutate("PULSE05 to Fuller1" = (Ful1-PULSE05)/PULSE05,#ifelse((Ful1-PULSE05)/PULSE05 >= 0, (Ful1-PULSE05)/PULSE05, -(PULSE05-Ful1)/Ful1),
"PULSE05 to Fuller4" = (Ful4-PULSE05)/PULSE05,#ifelse((Ful4-PULSE05)/PULSE05 >= 0, (Ful4-PULSE05)/PULSE05, -(PULSE05-Ful4)/Ful4),
"PULSE05 to TSLS" = (TSLS-PULSE05)/PULSE05,#ifelse((TSLS-PULSE05)/PULSE05 >= 0, (TSLS-PULSE05)/PULSE05, -(PULSE05-TSLS)/TSLS),
"PULSE05 to OLS" =(OLS-PULSE05)/PULSE05 #ifelse((OLS-PULSE05)/PULSE05 >= 0, (OLS-PULSE05)/PULSE05, -(PULSE05-OLS)/OLS),
)  %>%
select(-Ful1,-Ful4,-OLS,-PULSE05,-TSLS,-LIML)  %>%
gather(Type,Value,c(-Fstat,-rho,-nInst,-Conc,-Rsq,-n,-MeanGn )) %>%
mutate(rho=factor(rho), n = factor(n)) %>%
filter(!(Type=="PULSE05 to TSLS" & nInst <3 ))
ggplot(data = Variance_plotdata)+
geom_point(aes(x=log(MeanGn),y=Value,color=rho,shape=n)) +
geom_vline(xintercept =log(10),color="black",linetype="dotted") +
geom_vline(xintercept =log(1.55),color="black",linetype="dashed") +
facet_wrap(~Type,scales= "free")+
xlab(expression(log(hat(E)[N](G[n]))))+
labs(colour=expression(rho))+
ylab(expression(paste("Relative Change in Variance")))+
theme(plot.margin = unit(c(0,0.8,0,0), "cm"))
Variance_plotdata <- dat2 %>%
select(-MedianBias,-IQRestimate,-RMSE,-MeanEstimate) %>%
spread(Type,VarEstimate) %>%
arrange(rho,nInst,Rsq,n,nInst) %>%
mutate("PULSE05 to Fuller1" = (Ful1-PULSE05)/PULSE05,
"PULSE05 to Fuller4" = (Ful4-PULSE05)/PULSE05,
"PULSE05 to TSLS" = (TSLS-PULSE05)/PULSE05,
"PULSE05 to OLS" =(OLS-PULSE05)/PULSE05
)  %>%
select(-Ful1,-Ful4,-OLS,-PULSE05,-TSLS,-LIML)  %>%
gather(Type,Value,c(-Fstat,-rho,-nInst,-Conc,-Rsq,-n,-MeanGn )) %>%
mutate(rho=factor(rho), n = factor(n)) %>%
filter(!(Type=="PULSE05 to TSLS" & nInst <3) & !(Value>=100))
ggplot(data = Variance_plotdata)+
geom_point(aes(x=log(MeanGn),y=Value,color=rho,shape=n)) +
geom_vline(xintercept =log(10),color="black",linetype="dotted") +
geom_vline(xintercept =log(1.55),color="black",linetype="dashed") +
facet_wrap(~Type,scales= "free")+
xlab(expression(log(hat(E)[N](G[n]))))+
labs(colour=expression(rho))+
ylab(expression(paste("Relative Change in Variance")))+
theme(plot.margin = unit(c(0,0.8,0,0), "cm"))
Variance_plotdata <- dat2 %>%
select(-MedianBias,-IQRestimate,-RMSE,-MeanEstimate) %>%
spread(Type,VarEstimate) %>%
arrange(rho,nInst,Rsq,n,nInst) %>%
mutate("PULSE05 to Fuller1" = (Ful1-PULSE05)/PULSE05,
"PULSE05 to Fuller4" = (Ful4-PULSE05)/PULSE05,
"PULSE05 to TSLS" = (TSLS-PULSE05)/PULSE05,
"PULSE05 to OLS" =(OLS-PULSE05)/PULSE05
)  %>%
select(-Ful1,-Ful4,-OLS,-PULSE05,-TSLS,-LIML)  %>%
gather(Type,Value,c(-Fstat,-rho,-nInst,-Conc,-Rsq,-n,-MeanGn )) %>%
mutate(rho=factor(rho), n = factor(n)) %>%
filter(!(Type=="PULSE05 to TSLS" & nInst <3) )
ggplot(data = Variance_plotdata)+
geom_point(aes(x=log(MeanGn),y=Value,color=rho,shape=n)) +
geom_vline(xintercept =log(10),color="black",linetype="dotted") +
geom_vline(xintercept =log(1.55),color="black",linetype="dashed") +
facet_wrap(~Type,scales= "free")+
xlab(expression(log(hat(E)[N](G[n]))))+
labs(colour=expression(rho))+
ylab(expression(paste("Relative Change in Variance")))+
theme(plot.margin = unit(c(0,0.8,0,0), "cm"))
Variance_plotdata <- dat2 %>%
select(-MedianBias,-IQRestimate,-RMSE,-MeanEstimate) %>%
spread(Type,VarEstimate) %>%
arrange(rho,nInst,Rsq,n,nInst) %>%
mutate("PULSE05 to Fuller1" = (Ful1-PULSE05)/PULSE05,
"PULSE05 to Fuller4" = (Ful4-PULSE05)/PULSE05,
"PULSE05 to TSLS" = (TSLS-PULSE05)/PULSE05,
"PULSE05 to OLS" =(OLS-PULSE05)/PULSE05
)  %>%
select(-Ful1,-Ful4,-OLS,-PULSE05,-TSLS,-LIML)  %>%
gather(Type,Value,c(-Fstat,-rho,-nInst,-Conc,-Rsq,-n,-MeanGn )) %>%
mutate(rho=factor(rho), n = factor(n)) %>%
filter(!(Type=="PULSE05 to TSLS" & nInst <3) & !(Value>=100))
ggplot(data = Variance_plotdata)+
geom_point(aes(x=log(MeanGn),y=Value,color=rho,shape=n)) +
geom_vline(xintercept =log(10),color="black",linetype="dotted") +
geom_vline(xintercept =log(1.55),color="black",linetype="dashed") +
facet_wrap(~Type,scales= "free")+
xlab(expression(log(hat(E)[N](G[n]))))+
labs(colour=expression(rho))+
ylab(expression(paste("Relative Change in Variance")))+
theme(plot.margin = unit(c(0,0.8,0,0), "cm"))
ggsave(paste0("Plots/Univariate_Variance",ID,".png"), plot = last_plot(), device = NULL, path = NULL,
scale = 1, width = 12, height = 6, units = c("in"),
dpi = 200, limitsize = FALSE)
Variance_plotdata <- dat2 %>%
select(-MedianBias,-IQRestimate,-RMSE,-MeanEstimate) %>%
spread(Type,VarEstimate) %>%
arrange(rho,nInst,Rsq,n,nInst) %>%
mutate("PULSE05 to Fuller1" = (Ful1-PULSE05)/PULSE05,
"PULSE05 to Fuller4" = (Ful4-PULSE05)/PULSE05,
"PULSE05 to TSLS" = (TSLS-PULSE05)/PULSE05,
"PULSE05 to OLS" =(OLS-PULSE05)/PULSE05
)  %>%
select(-Ful1,-Ful4,-OLS,-PULSE05,-TSLS,-LIML)  %>%
gather(Type,Value,c(-Fstat,-rho,-nInst,-Conc,-Rsq,-n,-MeanGn )) %>%
mutate(rho=factor(rho), n = factor(n)) %>%
filter(!(Type=="PULSE05 to TSLS" & nInst <3) & !(Value>=101))
ggplot(data = Variance_plotdata)+
geom_point(aes(x=log(MeanGn),y=Value,color=rho,shape=n)) +
geom_vline(xintercept =log(10),color="black",linetype="dotted") +
geom_vline(xintercept =log(1.55),color="black",linetype="dashed") +
facet_wrap(~Type,scales= "free")+
xlab(expression(log(hat(E)[N](G[n]))))+
labs(colour=expression(rho))+
ylab(expression(paste("Relative Change in Variance")))+
theme(plot.margin = unit(c(0,0.8,0,0), "cm"))
Variance_plotdata <- dat2 %>%
select(-MedianBias,-IQRestimate,-RMSE,-MeanEstimate) %>%
spread(Type,VarEstimate) %>%
arrange(rho,nInst,Rsq,n,nInst) %>%
mutate("PULSE05 to Fuller1" = (Ful1-PULSE05)/PULSE05,
"PULSE05 to Fuller4" = (Ful4-PULSE05)/PULSE05,
"PULSE05 to TSLS" = (TSLS-PULSE05)/PULSE05,
"PULSE05 to OLS" =(OLS-PULSE05)/PULSE05
)  %>%
select(-Ful1,-Ful4,-OLS,-PULSE05,-TSLS,-LIML)  %>%
gather(Type,Value,c(-Fstat,-rho,-nInst,-Conc,-Rsq,-n,-MeanGn )) %>%
mutate(rho=factor(rho), n = factor(n)) %>%
filter(!(Type=="PULSE05 to TSLS" & nInst <3) & !(Value>=100))
ggplot(data = Variance_plotdata)+
geom_point(aes(x=log(MeanGn),y=Value,color=rho,shape=n)) +
geom_vline(xintercept =log(10),color="black",linetype="dotted") +
geom_vline(xintercept =log(1.55),color="black",linetype="dashed") +
facet_wrap(~Type,scales= "free")+
xlab(expression(log(hat(E)[N](G[n]))))+
labs(colour=expression(rho))+
ylab(expression(paste("Relative Change in Variance")))+
theme(plot.margin = unit(c(0,0.8,0,0), "cm"))
ggsave(paste0("Plots/Univariate_Variance",ID,".png"), plot = last_plot(), device = NULL, path = NULL,
scale = 1, width = 12, height = 6, units = c("in"),
dpi = 200, limitsize = FALSE)
IQR_plotdata <- dat2 %>%
select(-MedianBias,-VarEstimate,-RMSE,-MeanEstimate) %>%
spread(Type,IQRestimate) %>%
arrange(rho,nInst,Rsq,n,nInst) %>%
mutate("PULSE05 to Fuller1" = (Ful1-PULSE05)/PULSE05,
"PULSE05 to Fuller4" = (Ful4-PULSE05)/PULSE05,
"PULSE05 to TSLS" = (TSLS-PULSE05)/PULSE05,
"PULSE05 to OLS" =(OLS-PULSE05)/PULSE05
)  %>%
select(-Ful1,-Ful4,-OLS,-PULSE05,-PULSE10,-PULSE50,-TSLS,-LIML)  %>%
gather(Type,Value,c(-Fstat,-rho,-nInst,-Conc,-Rsq,-n,-MeanGn )) %>%
mutate(rho=factor(rho), n = factor(n)) %>%
filter(rho!=-0.5)
IQR_plotdata <- dat2 %>%
select(-MedianBias,-VarEstimate,-RMSE,-MeanEstimate) %>%
spread(Type,IQRestimate) %>%
arrange(rho,nInst,Rsq,n,nInst) %>%
mutate("PULSE05 to Fuller1" = (Ful1-PULSE05)/PULSE05,
"PULSE05 to Fuller4" = (Ful4-PULSE05)/PULSE05,
"PULSE05 to TSLS" = (TSLS-PULSE05)/PULSE05,
"PULSE05 to OLS" =(OLS-PULSE05)/PULSE05
)  %>%
select(-Ful1,-Ful4,-OLS,-PULSE05,-TSLS,-LIML)  %>%
gather(Type,Value,c(-Fstat,-rho,-nInst,-Conc,-Rsq,-n,-MeanGn )) %>%
mutate(rho=factor(rho), n = factor(n))
ggplot(data = IQR_plotdata)+
geom_point(aes(x=log(MeanGn),y=Value,color=rho,shape=n)) +
geom_vline(xintercept =log(10),color="black",linetype="dotted") +
geom_vline(xintercept =log(1.55),color="black",linetype="dashed") +
facet_wrap(~Type,scales= "free")+
xlab(expression(log(hat(E)[N](G[n]))))+
labs(colour=expression(rho))+
ylab(expression(paste("Relative Change in IQR")))+
theme(plot.margin = unit(c(0,0.8,0,0), "cm"))
ggsave(paste0("Plots/Univariate_IQR",ID,".png"), plot = last_plot(), device = NULL, path = NULL,
scale = 1, width = 12, height = 6, units = c("in"),
dpi = 200, limitsize = FALSE)
library(tidyverse)
library(magrittr)
library(stringr)
library(gridExtra)
# Read Data
Data_Location <- "Data/Experiment_Univariate_nSim_15000_nObsPerSim_50_100_150_20200714022524.RDS"
ID <- "20200714022524"
dat <- readRDS(file=Data_Location)
#
dat2 <- dat %>%
rowwise() %>%
mutate(Conc = n*Rsq/(1-Rsq), Fstat = Conc/nInst+1) %>%
select(rho,n,nInst,Rsq,Type,Conc,Fstat,
MeanGn,MedianBias,MeanEstimate,
RMSE,VarEstimate,IQRestimate) %>%
arrange(rho,Rsq,nInst,n)
n <- c(50,100,150)
q <- c(1,2,3,4,5,10,20,30)
expand_grid(n= n,q =q ) %>%
mutate(quantile= qf(c(0.95),df1=q,df2=n-q)) %>%
summarise(min=min(quantile),max=max(quantile)) %>%
mutate(logmin=log(min),logmax=log(max))
RMSE_plotdata <- dat2 %>%
select(-MedianBias,-IQRestimate,-MeanEstimate,-VarEstimate) %>%
spread(Type,RMSE) %>%
arrange(rho,nInst,Rsq,n,nInst) %>%
mutate("PULSE05 to Fuller1" = (Ful1-PULSE05)/PULSE05,
"PULSE05 to Fuller4" = (Ful4-PULSE05)/PULSE05,
"PULSE05 to TSLS" = (TSLS-PULSE05)/PULSE05,
"PULSE05 to OLS" =(OLS-PULSE05)/PULSE05
)  %>%
select(-Ful1,-Ful4,-OLS,-PULSE05,-TSLS,-LIML)  %>%
gather(Type,Value,c(-Fstat,-rho,-nInst,-Conc,-Rsq,-n,-MeanGn )) %>%
mutate(rho=factor(rho), n = factor(n)) %>%
filter(!(Type=="PULSE05 to TSLS" & nInst <3 ))
dummy <- data.frame(MeanGn=2,Value=-1)
ggplot(data = RMSE_plotdata)+
geom_point(aes(x=log(MeanGn),y=Value,color=rho,shape=n)) +
geom_vline(xintercept =log(10),color="black",linetype="dotted") +
geom_vline(xintercept =log(1.55),color="black",linetype="dashed") +
geom_blank(data=dummy,aes(x=MeanGn,y=Value))+
facet_wrap(~Type,scales= "free")+
xlab(expression(log(hat(E)[N](G[n]))))+
labs(colour=expression(rho))+
ylab(expression(paste("Relative Change in RMSE")))+
theme(plot.margin = unit(c(0,0.8,0,0), "cm"))
ggsave(paste0("Plots/Univariate_RMSE",ID,".png"), plot = last_plot(), device = NULL, path = NULL,
scale = 1, width = 12, height = 6, units = c("in"),
dpi = 200, limitsize = FALSE)
MeanBias_plotdata <- dat2 %>%
mutate(Bias = abs(MeanEstimate)) %>%
select(-MedianBias,-IQRestimate,-RMSE,-VarEstimate,-MeanEstimate) %>%
spread(Type,Bias) %>%
arrange(rho,nInst,Rsq,n,nInst) %>%
mutate("PULSE05 to Fuller1" = (Ful1-PULSE05)/PULSE05,
"PULSE05 to Fuller4" = (Ful4-PULSE05)/PULSE05,
"PULSE05 to TSLS" = (TSLS-PULSE05)/PULSE05,
"PULSE05 to OLS" =(OLS-PULSE05)/PULSE05
)  %>%
select(-Ful1,-Ful4,-OLS,-PULSE05,-TSLS,-LIML)  %>%
gather(Type,Value,c(-Fstat,-rho,-nInst,-Conc,-Rsq,-n,-MeanGn )) %>%
mutate(rho=factor(rho), n = factor(n)) %>%
filter(!(Type=="PULSE05 to TSLS" & nInst <2 ))
ggplot(data = MeanBias_plotdata)+
geom_point(aes(x=log(MeanGn),y=Value,color=rho,shape=n)) +
geom_vline(xintercept =log(10),color="black",linetype="dotted") +
geom_vline(xintercept =log(1.55),color="black",linetype="dashed") +
facet_wrap(~Type,scales= "free")+
xlab(expression(log(hat(E)[N](G[n]))))+
labs(colour=expression(rho))+
ylab(expression(paste("Relative Change in Mean Bias")))+
theme(plot.margin = unit(c(0,0.8,0,0), "cm"))
ggsave(paste0("Plots/Univariate_MeanBias",ID,".png"), plot = last_plot(), device = NULL, path = NULL,
scale = 1, width = 12, height = 6, units = c("in"),
dpi = 200, limitsize = FALSE)
Variance_plotdata <- dat2 %>%
select(-MedianBias,-IQRestimate,-RMSE,-MeanEstimate) %>%
spread(Type,VarEstimate) %>%
arrange(rho,nInst,Rsq,n,nInst) %>%
mutate("PULSE05 to Fuller1" = (Ful1-PULSE05)/PULSE05,
"PULSE05 to Fuller4" = (Ful4-PULSE05)/PULSE05,
"PULSE05 to TSLS" = (TSLS-PULSE05)/PULSE05,
"PULSE05 to OLS" =(OLS-PULSE05)/PULSE05
)  %>%
select(-Ful1,-Ful4,-OLS,-PULSE05,-TSLS,-LIML)  %>%
gather(Type,Value,c(-Fstat,-rho,-nInst,-Conc,-Rsq,-n,-MeanGn )) %>%
mutate(rho=factor(rho), n = factor(n)) %>%
filter(!(Type=="PULSE05 to TSLS" & nInst <3) & !(Value>=100))
ggplot(data = Variance_plotdata)+
geom_point(aes(x=log(MeanGn),y=Value,color=rho,shape=n)) +
geom_vline(xintercept =log(10),color="black",linetype="dotted") +
geom_vline(xintercept =log(1.55),color="black",linetype="dashed") +
facet_wrap(~Type,scales= "free")+
xlab(expression(log(hat(E)[N](G[n]))))+
labs(colour=expression(rho))+
ylab(expression(paste("Relative Change in Variance")))+
theme(plot.margin = unit(c(0,0.8,0,0), "cm"))
ggsave(paste0("Plots/Univariate_Variance",ID,".png"), plot = last_plot(), device = NULL, path = NULL,
scale = 1, width = 12, height = 6, units = c("in"),
dpi = 200, limitsize = FALSE)
IQR_plotdata <- dat2 %>%
select(-MedianBias,-VarEstimate,-RMSE,-MeanEstimate) %>%
spread(Type,IQRestimate) %>%
arrange(rho,nInst,Rsq,n,nInst) %>%
mutate("PULSE05 to Fuller1" = (Ful1-PULSE05)/PULSE05,
"PULSE05 to Fuller4" = (Ful4-PULSE05)/PULSE05,
"PULSE05 to TSLS" = (TSLS-PULSE05)/PULSE05,
"PULSE05 to OLS" =(OLS-PULSE05)/PULSE05
)  %>%
select(-Ful1,-Ful4,-OLS,-PULSE05,-TSLS,-LIML)  %>%
gather(Type,Value,c(-Fstat,-rho,-nInst,-Conc,-Rsq,-n,-MeanGn )) %>%
mutate(rho=factor(rho), n = factor(n))
ggplot(data = IQR_plotdata)+
geom_point(aes(x=log(MeanGn),y=Value,color=rho,shape=n)) +
geom_vline(xintercept =log(10),color="black",linetype="dotted") +
geom_vline(xintercept =log(1.55),color="black",linetype="dashed") +
facet_wrap(~Type,scales= "free")+
xlab(expression(log(hat(E)[N](G[n]))))+
labs(colour=expression(rho))+
ylab(expression(paste("Relative Change in IQR")))+
theme(plot.margin = unit(c(0,0.8,0,0), "cm"))
ggsave(paste0("Plots/Univariate_IQR",ID,".png"), plot = last_plot(), device = NULL, path = NULL,
scale = 1, width = 12, height = 6, units = c("in"),
dpi = 200, limitsize = FALSE)
Data_Location <- "Data/Experiment_Multivariate_VaryingConfounding_Beta00_PULSE05_nSim_5000_nObsPerSim_50_nModel_10000_20200714024302.RDS"
ID <- "20200714024302"
dat <- readRDS(file=Data_Location)
# Calculating MSE superiority percentages
Optimal <- dat %>%
select(n,nModel,Type,MSE) %>%
unique() %>%
spread(Type,MSE) %>%
rowwise() %>%
mutate(TrueSuperior = case_when( min(eigen(PULSE05-Ful4)$values) > 0 ~ "Ful4",
min(eigen(Ful4-PULSE05)$values) > 0 ~ "PULSE05",
TRUE ~ "Not comparable"),
TrueSuperiorVsFul1 = case_when( min(eigen(PULSE05-Ful1)$values) > 0 ~ "Ful1",
min(eigen(Ful1-PULSE05)$values) > 0 ~ "PULSE05",
TRUE ~ "Not comparable"),
TrueSuperiorVsOLS = case_when( min(eigen(PULSE05-OLS)$values) > 0 ~ "OLS",
min(eigen(OLS-PULSE05)$values) > 0 ~ "PULSE05",
TRUE ~ "Not comparable")) %>%
select(n,nModel,TrueSuperior,TrueSuperiorVsFul1,TrueSuperiorVsOLS)
Optimal %>% filter(TrueSuperior == TrueSuperiorVsFul1 & TrueSuperiorVsFul1== TrueSuperiorVsOLS)%>% group_by(TrueSuperior) %>%  summarise(count = n())
Ful4 <- Optimal %>% group_by(TrueSuperior) %>%  summarise(count = n()) %>% spread(TrueSuperior,count)
Ful1 <- Optimal %>% group_by(TrueSuperiorVsFul1) %>%  summarise(count = n()) %>%  spread(TrueSuperiorVsFul1,count)
OLS <- Optimal %>% group_by(TrueSuperiorVsOLS) %>%  summarise(count = n()) %>% spread(TrueSuperiorVsOLS,count)
bind_rows(Ful4,Ful1,OLS) %>%
mutate_all(.funs=function(x){round(100*x/10000,1)}) %>%
mutate_all(~replace(., is.na(.), 0.0))
Ful4 <- Optimal %>%
group_by(TrueSuperior) %>%
summarise(count = n()) %>%
spread(TrueSuperior,count)
Ful1 <- Optimal %>%
group_by(TrueSuperiorVsFul1) %>%
summarise(count = n()) %>%
spread(TrueSuperiorVsFul1,count)
OLS <- Optimal %>%
group_by(TrueSuperiorVsOLS) %>%
summarise(count = n()) %>%
spread(TrueSuperiorVsOLS,count)
bind_rows(Ful4,Ful1,OLS) %>%
mutate_all(.funs=function(x){round(100*x/10000,1)}) %>%
mutate_all(~replace(., is.na(.), 0.0))
Optimal <- dat %>%
select(n,nModel,Type,MSE) %>%
unique() %>%
spread(Type,MSE) %>%
rowwise() %>%
mutate(TrueSuperior = case_when( min(eigen(PULSE05-Ful4)$values) > 0 ~ "Ful4",
min(eigen(Ful4-PULSE05)$values) > 0 ~ "PULSE05",
TRUE ~ "Not comparable"),
TrueSuperiorVsFul1 = case_when( min(eigen(PULSE05-Ful1)$values) > 0 ~ "Ful1",
min(eigen(Ful1-PULSE05)$values) > 0 ~ "PULSE05",
TRUE ~ "Not comparable"),
TrueSuperiorVsOLS = case_when( min(eigen(PULSE05-OLS)$values) > 0 ~ "OLS",
min(eigen(OLS-PULSE05)$values) > 0 ~ "PULSE05",
TRUE ~ "Not comparable")) %>%
select(n,nModel,TrueSuperior)
# Saving only the MSE superiority versus Fuller(4)
Optimal <- Optimal %>%
select(n,nModel,TrueSuperior)
# Extracting Model Coefficients from data
Coefs <- dat %>%
filter(Type=="Ful1") %>%
select(nModel,ModelCoefs) %>%
unnest(cols=c(ModelCoefs)) %>%
mutate(Coef = rep(c(
"xi11",
"xi12",
"xi21",
"xi22",
"delta11",
"delta12",
"delta21",
"delta22",
"mu11",
"mu22",
"VepX1" ,
"VepX2" ,
"rhosq"),10000)
) %>%
unnest(cols=c(ModelCoefs)) %>%
spread(Coef,ModelCoefs) %>%
rename(RhoSq=rhosq)
