mutate(ID = 1:n())
holdoutextremes <- function(Data,noExtremes){
HoldOutDataset <- Data %>%
as_tibble() %>%
arrange(age) %>%
head(-noExtremes/2) %>%
tail(-noExtremes/2)
HeldOutSamples <- Data %>%
filter(ID %notin% HoldOutDataset$ID)
n <- nrow(HoldOutDataset)
#Target
Y <- HoldOutDataset %>% select(lwage76)  %>% as.matrix
#Included Exogenous:
A_1 <- HoldOutDataset %>% select(Intercept) %>%  as.matrix
#All Exogenous
A <- HoldOutDataset %>% select(nearc4,age,agesq,Intercept) %>% as.matrix
#Included Endogenous
X <- HoldOutDataset %>% select(ed76,exp,expsq) %>%  as.matrix
#Included (all)
Z <- cbind(X,A_1)
#OLS
ols <- K_class(0,A,Z,Y,n)
#IV
iv <- K_class(1,A,Z,Y,n)
#PULSE
pulse <- PULSE(A,A_1,X,Y,p=0.05,N=10000,n)
MSPE <- HeldOutSamples %>%
select(lwage76,Intercept,ed76,exp,expsq) %>%
mutate(resOLS = lwage76 - (ed76*ols["ed76",]+exp*ols["exp",]+expsq*ols["expsq",]+Intercept*ols["Intercept",]),
resIV = lwage76 - (ed76*iv["ed76",]+exp*iv["exp",]+expsq*iv["expsq",]+Intercept*iv["Intercept",]),
resPULSE = lwage76 - (ed76*pulse["ed76","lwage76"]+exp*pulse["exp","lwage76"]+expsq*pulse["expsq","lwage76"]+Intercept*pulse["Intercept","lwage76"])) %>%
summarize(OLS = sum(resOLS^2)/n(),
IV = sum(resIV^2)/n(),
PULSE = sum(resPULSE^2)/n(),
ORDER = case_when(OLS <= IV & IV <= PULSE ~ "OLS<IV<PULSE",
OLS < PULSE & PULSE <= IV ~ "OLS<PULSE<IV",
OLS == PULSE & PULSE <= IV ~ "PULSE=OLS<IV",
IV <= PULSE & PULSE < OLS ~ "IV<PULSE<OLS",
IV <= PULSE & PULSE == OLS ~ "IV<PULSE=OLS",
IV <= OLS & OLS <= PULSE ~ "IV<OLS<PULSE",
IV <= OLS & OLS == PULSE ~ "IV<OLS=PULSE",
PULSE < OLS & OLS <= IV ~ "PULSE<OLS<IV",
PULSE == OLS & OLS <= IV ~ "PULSE=OLS<IV",
PULSE <= IV & IV <= OLS ~ "PULSE<IV<OLS"
),
OLSmIV = OLS-IV,
OLSmPULSE = OLS-PULSE,
PULSEmIV = PULSE -IV,
coef.OLS = ols["ed76",],
coef.IV = iv["ed76",],
coef.PULSE = pulse["ed76","lwage76"]) %>%
mutate(t=pulse["Intercept","t"],q=pulse["Intercept","q"])
return(MSPE)
}
summarydat <-data.frame(n= c(250,500,750,1000,1250,1500,1750,2000,2250,2300)) %>%  #seq(500,2500 ,500)) %>%
rowwise() %>%
mutate(order=list(holdoutextremes(Proximity_Data,n)))%>%
unnest(cols=c(order))
summarydat %>%  select(n,OLS,IV,PULSE,ORDER,coef.OLS,coef.IV,coef.PULSE)
fff <-function(Data,no){
HoldOutDataset <-  Data %>%
as_tibble() %>%
arrange(iq) %>%
head(-no/2) %>%
tail(-no/2)
HeldOutSamples <- Data %>%
filter(ID %notin% HoldOutDataset$ID)
d <- data.frame(HoldOutVar = HoldOutDataset %>% summarize(var(iq) ) %>% pull,HeldOutVar = HeldOutSamples %>%  summarize(var(iq)) %>% pull)
return(d)
}
data.frame(no=seq(100,1800,100)) %>% rowwise() %>%  mutate( g= list(fff(Proximity_Data %>%  filter(kww!=0,iq!=0),no))) %>% unnest(cols=c(g)) %>% mutate(KappaForEquality = -(HoldOutVar-HeldOutVar)/HeldOutVar) %>% mutate(HeldOutOverHoldOut= HeldOutVar/HoldOutVar)
getwd()
source("../Estimators_Slow.R")
Proximity_Data <- read.delim(file="Data/nls.dat",sep="",header=FALSE)  %>% rename(
id                =  V1,
nearc2            =  V2,
nearc4          =  V3,
nearc4a         =  V4,
nearc4b         =  V5,
ed76            =  V6,
ed66              =  V7,
age76             =  V8,
daded           =  V9,
nodaded           =  V10,
momed           =  V11,
nomomed           =  V12,
weight          =  V13,
momdad14        =  V14,
sinmom14        =  V15,
step14          =  V16,
reg661          =  V17,
reg662          =  V18,
reg663          =  V19,
reg664          =  V20,
reg665            =  V21,
reg666            =  V22,
reg667            =  V23,
reg668            =  V24,
reg669            =  V25,
south66         =  V26,
work76          =  V27,
work78          =  V28,
lwage76         =  V29,
lwage78         =  V30,
famed           =  V31,
black             =  V32,
smsa76r         =  V33,
smsa78r         =  V34,
reg76r          =  V35,
reg78r            =  V36,
reg80r            =  V37,
smsa66r         =  V38,
wage76          =  V39,
wage78            =  V40,
wage80            =  V41,
noint78           =  V42,
noint80         =  V43,
enroll76          =  V44,
enroll78        =  V45,
enroll80          =  V46,
kww               =  V47,
iq                =  V48,
marsta76          =  V49,
marsta78        =  V50,
marsta80          =  V51,
libcrd14          =  V52
) %>% as_tibble() %>%
mutate(Intercept = 1)%>%
filter(lwage76 != ".") %>%
mutate(lwage76 = as.numeric(lwage76)) %>%
mutate(iq = ifelse(iq==".","0",iq)) %>%
mutate(iq = as.numeric(iq)) %>%
mutate(kww = ifelse(kww==".","0",kww)) %>%
mutate(kww = as.integer(kww)) %>%
mutate(exp = age76-ed76-6) %>%
mutate(expsq = exp^2) %>%
mutate(age=age76,agesq=age76^2) %>%
mutate(f1 = ifelse(famed==1,1,0),
f2 = ifelse(famed==2,1,0),
f3 = ifelse(famed==3,1,0),
f4 = ifelse(famed==4,1,0),
f5 = ifelse(famed==5,1,0),
f6 = ifelse(famed==6,1,0),
f7 = ifelse(famed==7,1,0),
f8 = ifelse(famed==8,1,0)) %>%
mutate(ID = 1:n())
set.seed(1)
holdoutrandom <- function(Data,percentage){
HoldOutDataset <- Data %>%
as_tibble() %>%
sample_frac(percentage)
HeldOutSamples <- Data %>%
filter(ID %notin% HoldOutDataset$ID)
n <- nrow(HoldOutDataset)
#Target
Y <- HoldOutDataset %>% select(lwage76)  %>% as.matrix
#Included Exogenous:
A_1 <- HoldOutDataset %>% select(black,smsa76r,reg76r,smsa66r,reg662,reg663,reg664,reg665,reg666,reg667,reg668,reg669,Intercept) %>%  as.matrix
#All Exogenous
A <- HoldOutDataset %>% select(nearc4,age,agesq,black,smsa76r,reg76r,smsa66r,reg662,reg663,reg664,reg665,reg666,reg667,reg668,reg669,Intercept) %>% as.matrix
#Included Endogenous
X <- HoldOutDataset %>% select(ed76,exp,expsq) %>%  as.matrix
#Included (all)
Z <- cbind(X,A_1)
#OLS
ols <- K_class(0,A,Z,Y,n)
#IV
iv <- K_class(1,A,Z,Y,n)
#PULSE
pulse <- PULSE(A,A_1,X,Y,p=0.05,N=10000,n)
#fuller4
fuller4 <-  K_class(FULLER_k(4,A,A_1,X,Y,n,1),A,Z,Y,n)
MSPE <- HeldOutSamples %>%
select(lwage76,black,smsa76r,reg76r,smsa66r,reg662,reg663,reg664,reg665,reg666,reg667,reg668,reg669,Intercept,ed76,exp,expsq) %>%
mutate(resOLS = lwage76 - (ed76*ols["ed76",]+exp*ols["exp",]+expsq*ols["expsq",]+black*ols["black",]+smsa76r*ols["smsa76r",]+reg76r*ols["reg76r",]+smsa66r*ols["smsa66r",]+reg662*ols["reg662",]+reg663*ols["reg663",]+reg664*ols["reg664",]+reg665*ols["reg665",]+reg666*ols["reg666",]+reg667*ols["reg667",]+reg668*ols["reg668",]+reg669*ols["reg669",]+Intercept*ols["Intercept",]),
resIV = lwage76 - (ed76*iv["ed76",]+exp*iv["exp",]+expsq*iv["expsq",]+black*iv["black",]+smsa76r*iv["smsa76r",]+reg76r*iv["reg76r",]+smsa66r*iv["smsa66r",]+reg662*iv["reg662",]+reg663*iv["reg663",]+reg664*iv["reg664",]+reg665*iv["reg665",]+reg666*iv["reg666",]+reg667*iv["reg667",]+reg668*iv["reg668",]+reg669*iv["reg669",]+Intercept*iv["Intercept",]),
resPULSE = lwage76 - (ed76*pulse["ed76","lwage76"]+exp*pulse["exp","lwage76"]+expsq*pulse["expsq","lwage76"]+black*pulse["black","lwage76"]+smsa76r*pulse["smsa76r","lwage76"]+reg76r*pulse["reg76r","lwage76"]+smsa66r*pulse["smsa66r","lwage76"]+reg662*pulse["reg662","lwage76"]+reg663*pulse["reg663","lwage76"]+reg664*pulse["reg664","lwage76"]+reg665*pulse["reg665","lwage76"]+reg666*pulse["reg666","lwage76"]+reg667*pulse["reg667","lwage76"]+reg668*pulse["reg668","lwage76"]+reg669*pulse["reg669","lwage76"]+Intercept*pulse["Intercept","lwage76"]),
resFULLER4 = lwage76 - (ed76*fuller4["ed76","lwage76"]+exp*fuller4["exp","lwage76"]+expsq*fuller4["expsq","lwage76"]+black*fuller4["black","lwage76"]+smsa76r*fuller4["smsa76r","lwage76"]+reg76r*fuller4["reg76r","lwage76"]+smsa66r*fuller4["smsa66r","lwage76"]+reg662*fuller4["reg662","lwage76"]+reg663*fuller4["reg663","lwage76"]+reg664*fuller4["reg664","lwage76"]+reg665*fuller4["reg665","lwage76"]+reg666*fuller4["reg666","lwage76"]+reg667*fuller4["reg667","lwage76"]+reg668*fuller4["reg668","lwage76"]+reg669*fuller4["reg669","lwage76"]+Intercept*fuller4["Intercept","lwage76"])) %>%
summarize(OLS = sum(resOLS^2)/n(),
IV = sum(resIV^2)/n(),
PULSE = sum(resPULSE^2)/n(),
FULLER4 = sum(resFULLER4^2)/n()) %>%
mutate(t=pulse["ed76","t"],q=pulse["ed76","q"],l=pulse["ed76","l"],k=pulse["ed76","k"])
return(MSPE)
}
norep <- 1000
summarydat <-data.frame(n=seq(1,norep,1)) %>%
rowwise() %>%
mutate(order=list(holdoutrandom(Proximity_Data  ,0.9)))
MSPEORDERS <- summarydat %>%
unnest(cols=c(order)) %>%
gather(key="Type",value="MSPE",c(OLS,IV,PULSE,FULLER4)) %>%
arrange(MSPE) %>%
group_by(n) %>%
summarise(n=max(n),
t=max(t),
q=max(q),
l=max(l),
k=max(k),
ORDER = paste0(Type,collapse="<")) %>%
mutate(ORDER=case_when(ORDER == "PULSE<OLS<IV<FULLER4" ~ "PULSE=OLS<IV<FULLER4",
ORDER == "OLS<PULSE<IV<FULLER4" ~ "PULSE=OLS<IV<FULLER4",
ORDER == "IV<FULLER4<PULSE<OLS" ~ "IV<FULLER4<PULSE=OLS",
ORDER == "IV<OLS<PULSE<FULLER4" ~ "IV<PULSE=OLS<FULLER4",
ORDER == "IV<PULSE<OLS<FULLER4" ~ "IV<PULSE=OLS<FULLER4",
ORDER == "FULLER4<IV<OLS<PULSE" ~ "FULLER4<IV<PULSE=OLS",
ORDER == "IV<FULLER4<OLS<PULSE" ~ "IV<FULLER4<PULSE=OLS",
))
summarydat %>%
unnest(cols=c(order)) %>%
left_join(.,MSPEORDERS %>% select(n,ORDER),by="n") %>%
ungroup %>%
group_by(ORDER) %>%
summarise(count= n(),
WMSPE.OLS = quantile(OLS,probs=0.9),
WMSPE.iv = quantile(IV,probs=0.9),
WMSPE.pulse = quantile(PULSE,probs=0.9),
WMSPE.fuller4 = quantile(FULLER4,probs=0.9),
OLS = mean(OLS),
PULSE = mean(PULSE),
IV = mean(IV),
FULLER4 = mean(FULLER4)
) %>%
mutate(Percentage = 100*count/norep) %>%
select(ORDER,Percentage,OLS,IV,PULSE,FULLER4,WMSPE.OLS,WMSPE.iv,WMSPE.pulse,WMSPE.fuller4) %>%
kbl(.,format="latex",digits=3)
summarydat %>%
unnest(cols=c(order)) %>%
gather(key="Type",value="MSPE",c(OLS,IV,PULSE,FULLER4)) %>%
arrange(MSPE) %>%
group_by(n) %>%
summarise(n=max(n),
t=max(t),
q=max(q),
l=max(l),
k=max(k),
ORDER = paste0(Type,collapse="<"))
summarydat %>%
unnest(cols=c(order)) %>%
gather(key="Type",value="MSPE",c(OLS,IV,PULSE,FULLER4)) %>%
arrange(MSPE) %>%
group_by(n) %>%
summarise(n=max(n),
t=max(t),
q=max(q),
l=max(l),
k=max(k),
ORDER = paste0(Type,collapse="<")) %>% select(ORDER) %>% unique()
MSPEORDERS <- summarydat %>%
unnest(cols=c(order)) %>%
gather(key="Type",value="MSPE",c(OLS,IV,PULSE,FULLER4)) %>%
arrange(MSPE) %>%
group_by(n) %>%
summarise(n=max(n),
t=max(t),
q=max(q),
l=max(l),
k=max(k),
ORDER = paste0(Type,collapse="<")) %>%
mutate(ORDER=case_when(ORDER == "PULSE<OLS<FULLER4<IV" ~ "PULSE=OLS<FULLER4<IV",
ORDER == "PULSE<OLS<IV<FULLER4" ~ "PULSE=OLS<IV<FULLER4",
ORDER == "OLS<PULSE<FULLER4<IV" ~ "PULSE=OLS<FULLER4<IV",
ORDER == "IV<FULLER4<OLS<PULSE" ~ "IV<FULLER4<PULSE=OLS",
ORDER == "OLS<PULSE<IV<FULLER4" ~ "PULSE=OLS<IV<FULLER4",
ORDER == "FULLER4<OLS<PULSE<IV" ~ "FULLER4<PULSE=OLS<IV",
ORDER == "FULLER4<PULSE<OLS<IV" ~ "FULLER4<PULSE=OLS<IV",
ORDER == "FULLER4<IV<PULSE<OLS" ~ "FULLER4<IV<PULSE=OLS",
ORDER == "IV<FULLER4<PULSE<OLS" ~ "IV<FULLER4<PULSE=OLS",
ORDER == "FULLER4<IV<OLS<PULSE" ~ "FULLER4<IV<PULSE=OLS",
ORDER == "IV<OLS<PULSE<FULLER" ~ "IV<PULSE=OLS<FULLER"
))
summarydat %>%
unnest(cols=c(order)) %>%
gather(key="Type",value="MSPE",c(OLS,IV,PULSE,FULLER4)) %>%
arrange(MSPE) %>%
group_by(n) %>%
summarise(n=max(n),
t=max(t),
q=max(q),
l=max(l),
k=max(k),
ORDER = paste0(Type,collapse="<")) %>% select(ORDER) %>% unique()
summarydat %>%
unnest(cols=c(order)) %>%
left_join(.,MSPEORDERS %>% select(n,ORDER),by="n") %>%
ungroup %>%
group_by(ORDER) %>%
summarise(count= n(),
WMSPE.OLS = quantile(OLS,probs=0.9),
WMSPE.iv = quantile(IV,probs=0.9),
WMSPE.pulse = quantile(PULSE,probs=0.9),
WMSPE.fuller4 = quantile(FULLER4,probs=0.9),
OLS = mean(OLS),
PULSE = mean(PULSE),
IV = mean(IV),
FULLER4 = mean(FULLER4)
) %>%
mutate(Percentage = 100*count/norep) %>%
select(ORDER,Percentage,OLS,IV,PULSE,FULLER4,WMSPE.OLS,WMSPE.iv,WMSPE.pulse,WMSPE.fuller4) %>%
kbl(.,format="latex",digits=3)
summarydat %>%
unnest(cols=c(order)) %>%
gather(key="Type",value="MSPE",c(OLS,IV,PULSE,FULLER4)) %>%
arrange(MSPE) %>%
group_by(n) %>%
summarise(n=max(n),
t=max(t),
q=max(q),
l=max(l),
k=max(k),
ORDER = paste0(Type,collapse="<")) %>% select(ORDER) %>% unique()
summarydat %>%
unnest(cols=c(order)) %>%
left_join(.,MSPEORDERS %>% select(n,ORDER),by="n") %>%
ungroup %>%
group_by(ORDER) %>%
summarise(count= n(),
WMSPE.OLS = quantile(OLS,probs=0.9),
WMSPE.iv = quantile(IV,probs=0.9),
WMSPE.pulse = quantile(PULSE,probs=0.9),
WMSPE.fuller4 = quantile(FULLER4,probs=0.9),
OLS = mean(OLS),
PULSE = mean(PULSE),
IV = mean(IV),
FULLER4 = mean(FULLER4)
) %>%
mutate(Percentage = 100*count/norep)
summarydat %>%
unnest(cols=c(order)) %>%
gather(key="Type",value="MSPE",c(OLS,IV,PULSE,FULLER4)) %>%
arrange(MSPE) %>%
group_by(n) %>%
summarise(n=max(n),
t=max(t),
q=max(q),
l=max(l),
k=max(k),
ORDER = paste0(Type,collapse="<")) %>% select(ORDER) %>% unique()
summarydat %>%
unnest(cols=c(order)) %>%
left_join(.,MSPEORDERS %>% select(n,ORDER),by="n")
summarydat %>%
unnest(cols=c(order)) %>%
left_join(.,MSPEORDERS %>% select(n,ORDER),by="n") %>% select(ORDER) %>%  unique()
MSPEORDERS <- summarydat %>%
unnest(cols=c(order)) %>%
gather(key="Type",value="MSPE",c(OLS,IV,PULSE,FULLER4)) %>%
arrange(MSPE) %>%
group_by(n) %>%
summarise(n=max(n),
t=max(t),
q=max(q),
l=max(l),
k=max(k),
ORDER = paste0(Type,collapse="<")) %>%
mutate(ORDER=case_when(ORDER == "PULSE<OLS<FULLER4<IV" ~ "PULSE=OLS<FULLER4<IV",
ORDER == "PULSE<OLS<IV<FULLER4" ~ "PULSE=OLS<IV<FULLER4",
ORDER == "OLS<PULSE<FULLER4<IV" ~ "PULSE=OLS<FULLER4<IV",
ORDER == "IV<FULLER4<OLS<PULSE" ~ "IV<FULLER4<PULSE=OLS",
ORDER == "OLS<PULSE<IV<FULLER4" ~ "PULSE=OLS<IV<FULLER4",
ORDER == "FULLER4<OLS<PULSE<IV" ~ "FULLER4<PULSE=OLS<IV",
ORDER == "FULLER4<PULSE<OLS<IV" ~ "FULLER4<PULSE=OLS<IV",
ORDER == "FULLER4<IV<PULSE<OLS" ~ "FULLER4<IV<PULSE=OLS",
ORDER == "IV<FULLER4<PULSE<OLS" ~ "IV<FULLER4<PULSE=OLS",
ORDER == "FULLER4<IV<OLS<PULSE" ~ "FULLER4<IV<PULSE=OLS",
ORDER == "IV<OLS<PULSE<FULLER" ~ "IV<PULSE=OLS<FULLER"
))
MSPEORDERS
MSPEORDERS %>%  select(n)
MSPEORDERS %>%  filter(ORDER==NA)
summarydat %>%
unnest(cols=c(order)) %>%
gather(key="Type",value="MSPE",c(OLS,IV,PULSE,FULLER4)) %>%
arrange(MSPE) %>%
group_by(n) %>%
summarise(n=max(n),
t=max(t),
q=max(q),
l=max(l),
k=max(k),
ORDER = paste0(Type,collapse="<")) %>% select(ORDER) %>% unique()
MSPEORDERS %>%  select(ORDER) %>% unique()
MSPEORDERS <- summarydat %>%
unnest(cols=c(order)) %>%
gather(key="Type",value="MSPE",c(OLS,IV,PULSE,FULLER4)) %>%
arrange(MSPE) %>%
group_by(n) %>%
summarise(n=max(n),
t=max(t),
q=max(q),
l=max(l),
k=max(k),
ORDER = paste0(Type,collapse="<")) %>%
mutate(ORDER=case_when(ORDER == "PULSE<OLS<FULLER4<IV" ~ "PULSE=OLS<FULLER4<IV",
ORDER == "PULSE<OLS<IV<FULLER4" ~ "PULSE=OLS<IV<FULLER4",
ORDER == "OLS<PULSE<FULLER4<IV" ~ "PULSE=OLS<FULLER4<IV",
ORDER == "IV<FULLER4<OLS<PULSE" ~ "IV<FULLER4<PULSE=OLS",
ORDER == "OLS<PULSE<IV<FULLER4" ~ "PULSE=OLS<IV<FULLER4",
ORDER == "FULLER4<OLS<PULSE<IV" ~ "FULLER4<PULSE=OLS<IV",
ORDER == "FULLER4<PULSE<OLS<IV" ~ "FULLER4<PULSE=OLS<IV",
ORDER == "FULLER4<IV<PULSE<OLS" ~ "FULLER4<IV<PULSE=OLS",
ORDER == "IV<FULLER4<PULSE<OLS" ~ "IV<FULLER4<PULSE=OLS",
ORDER == "FULLER4<IV<OLS<PULSE" ~ "FULLER4<IV<PULSE=OLS",
ORDER == "IV<OLS<PULSE<FULLER" ~ "IV<PULSE=OLS<FULLER",
))
summarydat %>%
unnest(cols=c(order)) %>%
left_join(.,MSPEORDERS %>% select(n,ORDER),by="n") %>%
ungroup %>%
group_by(ORDER) %>%
summarise(count= n(),
WMSPE.OLS = quantile(OLS,probs=0.9),
WMSPE.iv = quantile(IV,probs=0.9),
WMSPE.pulse = quantile(PULSE,probs=0.9),
WMSPE.fuller4 = quantile(FULLER4,probs=0.9),
OLS = mean(OLS),
PULSE = mean(PULSE),
IV = mean(IV),
FULLER4 = mean(FULLER4)
) %>%
mutate(Percentage = 100*count/norep) %>%
select(ORDER,Percentage,OLS,IV,PULSE,FULLER4,WMSPE.OLS,WMSPE.iv,WMSPE.pulse,WMSPE.fuller4) %>%
kbl(.,format="latex",digits=3)
summarydat %>%
unnest(cols=c(order)) %>%
gather(key="Type",value="MSPE",c(OLS,IV,PULSE,FULLER4)) %>%
arrange(MSPE) %>%
group_by(n) %>%
summarise(n=max(n),
t=max(t),
q=max(q),
l=max(l),
k=max(k),
ORDER = paste0(Type,collapse="<")) %>% select(ORDER) %>% unique()
summarydat %>%
unnest(cols=c(order)) %>%
gather(key="Type",value="MSPE",c(OLS,IV,PULSE,FULLER4)) %>%
arrange(MSPE) %>%
group_by(n) %>%
summarise(n=max(n),
t=max(t),
q=max(q),
l=max(l),
k=max(k),
ORDER = paste0(Type,collapse="<")) %>% select(ORDER) %>% unique()
MSPEORDERS <- summarydat %>%
unnest(cols=c(order)) %>%
gather(key="Type",value="MSPE",c(OLS,IV,PULSE,FULLER4)) %>%
arrange(MSPE) %>%
group_by(n) %>%
summarise(n=max(n),
t=max(t),
q=max(q),
l=max(l),
k=max(k),
ORDER = paste0(Type,collapse="<")) %>%
mutate(ORDER=case_when(ORDER == "PULSE<OLS<FULLER4<IV" ~ "PULSE=OLS<FULLER4<IV",
ORDER == "PULSE<OLS<IV<FULLER4" ~ "PULSE=OLS<IV<FULLER4",
ORDER == "OLS<PULSE<FULLER4<IV" ~ "PULSE=OLS<FULLER4<IV",
ORDER == "IV<FULLER4<OLS<PULSE" ~ "IV<FULLER4<PULSE=OLS",
ORDER == "OLS<PULSE<IV<FULLER4" ~ "PULSE=OLS<IV<FULLER4",
ORDER == "FULLER4<OLS<PULSE<IV" ~ "FULLER4<PULSE=OLS<IV",
ORDER == "FULLER4<PULSE<OLS<IV" ~ "FULLER4<PULSE=OLS<IV",
ORDER == "FULLER4<IV<PULSE<OLS" ~ "FULLER4<IV<PULSE=OLS",
ORDER == "IV<FULLER4<PULSE<OLS" ~ "IV<FULLER4<PULSE=OLS",
ORDER == "FULLER4<IV<OLS<PULSE" ~ "FULLER4<IV<PULSE=OLS",
ORDER == "IV<OLS<PULSE<FULLER4" ~ "IV<PULSE=OLS<FULLER4",
))
summarydat %>%
unnest(cols=c(order)) %>%
left_join(.,MSPEORDERS %>% select(n,ORDER),by="n") %>%
ungroup %>%
group_by(ORDER) %>%
summarise(count= n(),
WMSPE.OLS = quantile(OLS,probs=0.9),
WMSPE.iv = quantile(IV,probs=0.9),
WMSPE.pulse = quantile(PULSE,probs=0.9),
WMSPE.fuller4 = quantile(FULLER4,probs=0.9),
OLS = mean(OLS),
PULSE = mean(PULSE),
IV = mean(IV),
FULLER4 = mean(FULLER4)
) %>%
mutate(Percentage = 100*count/norep) %>%
select(ORDER,Percentage,OLS,IV,PULSE,FULLER4,WMSPE.OLS,WMSPE.iv,WMSPE.pulse,WMSPE.fuller4) %>%
kbl(.,format="latex",digits=3)
summarydat %>%
unnest(cols=c(order)) %>%
left_join(.,MSPEORDERS %>% select(n,ORDER),by="n") %>%
ungroup %>%
group_by(ORDER) %>%
summarise(count= n(),
WMSPE.OLS = quantile(OLS,probs=0.9),
WMSPE.iv = quantile(IV,probs=0.9),
WMSPE.pulse = quantile(PULSE,probs=0.9),
WMSPE.fuller4 = quantile(FULLER4,probs=0.9),
OLS = mean(OLS),
PULSE = mean(PULSE),
IV = mean(IV),
FULLER4 = mean(FULLER4)
) %>%
mutate(Percentage = 100*count/norep) %>%
select(ORDER,Percentage,OLS,IV,PULSE,FULLER4,WMSPE.OLS,WMSPE.iv,WMSPE.pulse,WMSPE.fuller4) %>%
kbl(.,format="latex",digits=3)
where A,A_1,X,Z,Y are the datamatrices (rowwise obeservations) for: all exogenous, included exogenous, included endogenous and target endogeous, respectively. If there is no included exogenous variables, then set A_1= "none". p is the $p_{min}$ for PULSE rejection threshold. 1/N is the precision of the binary search (in the lambda space).
## Replicate Empirical Analysis
See readme in subfolder Empirical_Analysis
where A,A_1,X,Z,Y are the datamatrices (rowwise obeservations) for: all exogenous, included exogenous, included endogenous and target endogeous, respectively. If there is no included exogenous variables, then set A_1= "none". p is the $p_{min}$ for PULSE rejection threshold. 1/N is the precision of the binary search (in the lambda space).
## Replicate Empirical Analysis
See readme in subfolder Empirical_Analysis
## Replicate Empirical Analysis
See readme in sub-folder /Empirical_Analysis
